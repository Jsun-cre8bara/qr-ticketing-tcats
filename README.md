# 🎫 QR 티켓팅 시스템 (TCATS)

티켓츠(TCATS) QR 기반 공연 티켓 발권 및 동반자 등록 시스템

## ✨ 주요 기능

### 1. 예매자 QR 발권
- 공연 선택 및 예매자 본인 확인
- SMS 인증을 통한 보안 강화
- 좌석 선택 (비지정석의 경우)
- QR 코드 발급 및 다운로드

### 2. **🆕 QR 티켓 공유 (동반자 등록)**
- **짧은 URL 생성**: 6자리 고유 ID로 간편한 공유
- **다양한 공유 방법**: 카카오톡, 문자 메시지, 이메일 등
- **중복 사용 방지**: 한 티켓당 한 명만 등록 가능
- **동반자 정보 등록 필수**: QR 사용 전 본인 정보 등록
- **동반자 전용 QR 발급**: 등록 완료 후 본인 이름으로 된 QR 코드 발급

### 3. 지역 할인 혜택 (스탬프북)
- 동반자 등록 시 지역 제휴 할인 혜택 제공
- 카페, 레스토랑, 주차장 등 다양한 혜택

## 🔄 동반자 등록 프로세스

```
예매자 QR 발급
    ↓
📤 공유 버튼 클릭
    ↓
🔗 짧은 링크 생성 (예: http://localhost:8501/?ticket_id=ABC123)
    ↓
📱 카카오톡/문자로 동반자에게 전송
    ↓
👥 동반자가 링크 클릭하여 정보 등록
    ↓
🎫 동반자 전용 QR 코드 발급
    ↓
✅ 공연장 입장 가능
```

## 🛡️ 보안 기능

- **SMS 인증**: 4자리 인증 코드, 3분 유효, 최대 5회 시도
- **중복 등록 방지**: 한 티켓 ID당 한 명만 등록 가능
- **등록자 확인**: 동반자 이름과 전화번호 기록
- **QR 유효시간**: 발급 후 4시간 동안만 유효

## 📁 데이터 구조

### 1. `data/reservations.xlsx`
예매자 정보 데이터베이스
- 예매번호, 이름, 전화번호, 공연명, 공연일시, 회차, 좌석번호

### 2. `data/companion_info.csv`
동반자 등록 정보
- 등록일시, 예매번호, 공연명, 좌석번호, 이름, 전화번호, 성별, 거주지역

### 3. **🆕 `data/shared_tickets.json`**
공유 티켓 관리 데이터베이스
```json
{
  "ABC123": {
    "ticket_data": {...},
    "created_at": "2024-11-02 12:00:00",
    "is_registered": true,
    "registered_by": "홍길동",
    "registered_phone": "010-1234-5678",
    "registered_at": "2024-11-02 12:30:00"
  }
}
```

## 🚀 설치 및 실행

### 필수 요구사항
- Python 3.8 이상
- pip

### 설치
```bash
# 의존성 설치
pip install -r requirements.txt

# 샘플 데이터 생성 (최초 1회)
python create-sample_data.py
python create_seat_status.py
```

### 실행
```bash
streamlit run app.py
```

앱이 `http://localhost:8501`에서 실행됩니다.

## 🎨 기술 스택

- **프레임워크**: Streamlit
- **QR 코드**: qrcode, Pillow
- **데이터 처리**: Pandas, OpenPyXL
- **언어**: Python 3.x

## 📝 사용 가이드

### 예매자 (티켓 소유자)
1. 공연 정보 선택
2. 이름과 전화번호 뒷 4자리 입력
3. SMS 인증 완료
4. QR 코드 발급 받기
5. **📤 공유 버튼**을 눌러 동반자에게 링크 전송

### 동반자
1. 예매자에게 받은 링크 클릭
2. 본인 정보 입력 (이름, 전화번호, 성별, 거주지역)
3. **✅ 등록하고 QR 발급받기** 버튼 클릭
4. 본인 이름으로 된 QR 코드 다운로드
5. 공연장 입장 시 QR 코드 제시

## ⚠️ 주의사항

- 공유 링크는 **한 번만 사용** 가능합니다
- 이미 등록된 티켓은 다른 사람이 등록할 수 없습니다
- QR 코드는 발급 후 **4시간 동안만 유효**합니다
- 동반자는 등록한 본인만 해당 QR로 입장 가능합니다

## 🔧 설정

### 배포 시 변경 필요 사항
`app.py` Line 1048:
```python
base_url = "http://localhost:8501"  # 실제 도메인으로 변경
```

실제 배포 URL로 변경하세요. 예:
```python
base_url = "https://tickets.tcats.com"
```

## 📄 라이선스

MIT License
